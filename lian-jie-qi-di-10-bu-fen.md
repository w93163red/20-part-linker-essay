# 链接器第10部分

## 并行链接

链接过程可以在某种程度上并行化。这可以帮助隐藏I/O延迟，并可以更好地利用现代多核系统。我在gold中的意图是使用这些想法来加速链接过程。

可以并行化的第一个领域是读取所有输入文件的符号和重定位条目。符号必须按顺序处理；否则，链接器将难以正确解析多重定义。特别是，在处理归档之前使用的所有符号必须在处理归档之前完全处理，否则链接器将不知道要包含归档中的哪些成员（我想我还没有讨论过归档）。然而，尽管有这些排序要求，实际的I/O仍然可以并行进行，这可能会带来好处。

在读取所有符号和重定位之后，链接器必须完成所有输入内容的布局。大部分这种工作无法并行进行，因为设置一种类型内容的位置需要知道所有前面类型内容的大小。在进行布局时，链接器可以确定需要写出的所有数据在输出文件中的最终位置。

布局完成后，读取内容、应用重定位和将内容写入输出文件的过程可以完全并行化。每个输入文件可以单独处理。

由于在布局阶段后已知输出文件的最终大小，因此可以对输出文件使用mmap。当不进行代码松弛时，就可以将输入内容直接读取到输出文件中的适当位置，并在那里进行重定位。这减少了所需的系统调用数量，理想情况下将允许操作系统对输出文件进行最优的磁盘I/O。

今晚就到这里。明天还会有更多内容。

