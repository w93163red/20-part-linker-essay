# 链接器第18部分

## 增量链接

通常，程序员会更改单个源文件并重新编译和重新链接应用程序。标准链接器需要读取所有输入对象和库以重新生成可执行文件。对于大型应用程序，这是一项大工作。如果只有一个输入对象文件发生变化，这比实际需要的工作要多得多。一个解决方案是使用增量链接器。增量链接器对现有的可执行文件或共享库进行增量更改，而不是从头重建它们。

我从未实际编写或使用过增量链接器，但总体思路是直截了当的。当链接器写出输出文件时，它必须附加额外的信息。

* 链接器必须创建对象文件到输出文件中区域的映射，这样增量链接就知道在替换对象文件时要删除什么。
* 链接器必须保留每个输入对象的所有重定位，这些重定位引用其他对象中定义的符号，以便在符号更改时可以重新处理它们。链接器应该按符号存储重定位的映射，以便快速找到相关的重定位。
* 链接器应该在文本和数据段中留出额外的空间，以允许对象文件在有限程度上增长而不需要重写整个可执行文件。它必须保留这些额外空间的位置图，因为它会随着增量链接的进行而移动。
* 链接器应该在输出文件中保留对象文件时间戳列表，以便快速确定哪些对象发生了变化。

有了这些信息，链接器可以识别自上次链接输出文件以来哪些对象文件发生了变化，并在现有输出文件中替换它们。当一个对象文件发生变化时，链接器可以识别所有引用该对象文件中定义的符号的重定位，并重新处理它们。

当一个对象文件变得太大而无法适应文本或数据段中的可用空间时，链接器可以选择在不同地址创建额外的文本或数据段。这需要一些小心，以确保新代码不会与堆冲突，这取决于本地malloc实现的工作方式。或者，增量链接器可以退回到进行完整链接，并再次分配更多空间。

增量链接可以大大加速编辑/编译/调试周期。不幸的是，它在大多数常见的链接器中没有实现。当然，增量链接并不等同于最终链接，特别是一些链接器优化在增量操作时很难实现。增量链接实际上只适合在开发周期中使用，当然这是链接器速度最重要的时候。

周一还会有更多内容。
